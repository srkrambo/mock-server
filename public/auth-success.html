<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication Successful - Mock Server</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            padding: 40px;
            max-width: 700px;
            width: 100%;
        }
        
        .success-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .success-icon {
            font-size: 64px;
            margin-bottom: 10px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            font-size: 14px;
        }
        
        .user-info {
            background: #f5f7fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        
        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-right: 15px;
        }
        
        .user-details h3 {
            color: #333;
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .user-details p {
            color: #666;
            font-size: 14px;
        }
        
        .token-section {
            margin-bottom: 30px;
        }
        
        .token-section h2 {
            color: #333;
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .token-container {
            background: #f5f7fa;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            padding: 15px;
            position: relative;
        }
        
        .token-text {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 12px;
            color: #333;
            word-break: break-all;
            line-height: 1.6;
            max-height: 120px;
            overflow-y: auto;
        }
        
        .copy-btn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
            transition: background 0.3s ease;
        }
        
        .copy-btn:hover {
            background: #5568d3;
        }
        
        .copy-btn.copied {
            background: #10b981;
        }
        
        .info-box {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .info-box h3 {
            color: #1e40af;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .info-box p {
            color: #1e40af;
            font-size: 13px;
            line-height: 1.6;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5568d3;
        }
        
        .btn-secondary {
            background: #f5f7fa;
            color: #333;
            border: 1px solid #e1e4e8;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
        }
        
        .code-example {
            background: #1e1e1e;
            color: #d4d4d4;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
        }
        
        .code-example .comment {
            color: #6a9955;
        }
        
        .code-example .string {
            color: #ce9178;
        }
        
        .code-example .keyword {
            color: #569cd6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="success-header">
            <div class="success-icon">âœ…</div>
            <h1>Authentication Successful!</h1>
            <p class="subtitle">You're now authenticated with Google</p>
        </div>
        
        <div id="user-info" class="user-info" style="display: none;">
            <img id="user-avatar" class="user-avatar" src="" alt="User Avatar">
            <div class="user-details">
                <h3 id="user-name"></h3>
                <p id="user-email"></p>
            </div>
        </div>
        
        <div class="token-section">
            <h2>Your JWT Token</h2>
            <div class="token-container">
                <div class="token-text" id="token-display">Loading...</div>
                <button class="copy-btn" id="copy-btn" onclick="copyToken()">ðŸ“‹ Copy Token</button>
            </div>
        </div>
        
        <div class="info-box">
            <h3>ðŸ’¡ How to use your token:</h3>
            <p>Use this token in the Authorization header to generate API keys and make authenticated requests.</p>
            <div class="code-example" id="code-example">
<span class="comment"># Generate an API key</span>
<span id="curl-command">curl -X POST http://localhost:8080/api/generate-key \</span>
  -H <span class="string">"Content-Type: application/json"</span> \
  -H <span class="string">"Authorization: Bearer YOUR_TOKEN_HERE"</span> \
  -d <span class="string">'{"metadata": {"description": "My API key"}}'</span>
            </div>
        </div>
        
        <div class="action-buttons">
            <a href="#" class="btn btn-primary" id="generate-key-btn">Generate API Key</a>
            <a href="#" class="btn btn-secondary" id="back-to-login-btn">Back to Login</a>
        </div>
    </div>
    
    <script>
        let jwtToken = '';
        let userData = {};
        
        // Detect base path from current URL
        function getBasePath() {
            const path = window.location.pathname;
            // If we're at /mock-server/auth/success, base path is /mock-server
            // If we're at /auth/success, base path is empty
            const match = path.match(/^(\/[^\/]+)?\/auth\/success/);
            return match && match[1] ? match[1] : '';
        }
        
        const basePath = getBasePath();
        
        // Parse URL parameters
        function getUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            return {
                token: urlParams.get('token'),
                email: urlParams.get('email'),
                name: urlParams.get('name'),
                picture: urlParams.get('picture')
            };
        }
        
        // Initialize page
        function init() {
            const params = getUrlParams();
            
            if (params.token) {
                jwtToken = params.token;
                document.getElementById('token-display').textContent = jwtToken;
                
                // Display user info if available
                if (params.email || params.name) {
                    userData = {
                        email: params.email,
                        name: params.name,
                        picture: params.picture
                    };
                    displayUserInfo();
                }
                
                // Set up generate key button with base path
                document.getElementById('generate-key-btn').href = basePath + `/auth/generate-key?token=${encodeURIComponent(jwtToken)}`;
            } else {
                document.getElementById('token-display').textContent = 'No token found. Please authenticate again.';
                document.getElementById('copy-btn').disabled = true;
            }
            
            // Set up back to login button with base path
            document.getElementById('back-to-login-btn').href = basePath + '/auth/login';
            
            // Update curl command with base path
            const curlCommand = document.getElementById('curl-command');
            if (curlCommand) {
                const port = window.location.port || '80';
                const protocol = window.location.protocol;
                const hostname = window.location.hostname;
                const baseUrl = `${protocol}//${hostname}${port !== '80' && port !== '443' ? ':' + port : ''}${basePath}`;
                curlCommand.textContent = `curl -X POST ${baseUrl}/api/generate-key \\`;
            }
        }
        
        // Display user information
        function displayUserInfo() {
            const userInfoDiv = document.getElementById('user-info');
            const userAvatar = document.getElementById('user-avatar');
            const userName = document.getElementById('user-name');
            const userEmail = document.getElementById('user-email');
            
            if (userData.picture) {
                userAvatar.src = userData.picture;
            } else {
                userAvatar.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzAiIGN5PSIzMCIgcj0iMzAiIGZpbGw9IiM2NjdlZWEiLz4KPHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyNCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj4/PC90ZXh0Pgo8L3N2Zz4=';
            }
            
            userName.textContent = userData.name || 'User';
            userEmail.textContent = userData.email || '';
            
            userInfoDiv.style.display = 'flex';
        }
        
        // Copy token to clipboard
        function copyToken() {
            const tokenText = document.getElementById('token-display').textContent;
            const copyBtn = document.getElementById('copy-btn');
            
            navigator.clipboard.writeText(tokenText).then(() => {
                const originalText = copyBtn.textContent;
                copyBtn.textContent = 'âœ“ Copied!';
                copyBtn.classList.add('copied');
                
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                alert('Failed to copy token. Please copy it manually.');
            });
        }
        
        // Initialize on page load
        init();
    </script>
</body>
</html>
